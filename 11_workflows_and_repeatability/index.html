
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="http://dib-lab.github.io/dib_rotation/11_workflows_and_repeatability/">
      
      
        <link rel="prev" href="../10_annotating_amino_acid_sequences/">
      
      
        <link rel="next" href="../12_angus_github/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.8">
    
    
      
        <title>Automation, Workflows, and Repeatability - dib-lab metagenomics rotation project</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-orange" data-md-color-accent="black">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#workflows-automation-and-repeatability" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="dib-lab metagenomics rotation project" class="md-header__button md-logo" aria-label="dib-lab metagenomics rotation project" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            dib-lab metagenomics rotation project
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Automation, Workflows, and Repeatability
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dib-lab/dib_rotation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    dib_rotation
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="dib-lab metagenomics rotation project" class="md-nav__button md-logo" aria-label="dib-lab metagenomics rotation project" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82Z"/></svg>

    </a>
    dib-lab metagenomics rotation project
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dib-lab/dib_rotation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    dib_rotation
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Setup
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_farm_account/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting up Farm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_conda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Conda
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Background Reading
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Background Reading
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_background_reading/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scientific Literature
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00a_unix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unix Tutorials
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../04_documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Keeping a Lab Notebook
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../04b_starting_a_work_session/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Starting a Work Session
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Metagenomics Project
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Metagenomics Project
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05_starting_with_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Find and download the data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06_quality_control/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quality Control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07_taxonomic_discovery_with_sourmash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Taxonomic Discovery with Sourmash
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08_bin_completion_with_spacegraphcats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bin Completion with Spacegraphcats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09_assembling_a_nbhd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Assembling a Nbhd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10_annotating_amino_acid_sequences/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Annotating amino acid sequences
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Advanced Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Automation, Workflows, and Repeatability
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Automation, Workflows, and Repeatability
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#writing-a-shell-script" class="md-nav__link">
    <span class="md-ellipsis">
      Writing a shell script
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Writing a shell script">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#re-running-the-shell-script" class="md-nav__link">
    <span class="md-ellipsis">
      Re-running the shell script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#some-tricks-for-writing-shell-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      Some tricks for writing shell scripts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Some tricks for writing shell scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make-it-executable" class="md-nav__link">
    <span class="md-ellipsis">
      Make it executable
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation-with-workflow-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Automation with Workflow Systems!
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#snakemake" class="md-nav__link">
    <span class="md-ellipsis">
      Snakemake
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Snakemake">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-all-files-at-once" class="md-nav__link">
    <span class="md-ellipsis">
      Running all files at once
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-an-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Adding an environment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-automate-with-workflow-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Why Automate with Workflow Systems?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bonus-exercise" class="md-nav__link">
    <span class="md-ellipsis">
      Bonus exercise
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../12_angus_github/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Version Control with Git and GitHub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../13_contribute_on_github/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contribute on GitHub
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#writing-a-shell-script" class="md-nav__link">
    <span class="md-ellipsis">
      Writing a shell script
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Writing a shell script">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#re-running-the-shell-script" class="md-nav__link">
    <span class="md-ellipsis">
      Re-running the shell script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#some-tricks-for-writing-shell-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      Some tricks for writing shell scripts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Some tricks for writing shell scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make-it-executable" class="md-nav__link">
    <span class="md-ellipsis">
      Make it executable
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation-with-workflow-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Automation with Workflow Systems!
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#snakemake" class="md-nav__link">
    <span class="md-ellipsis">
      Snakemake
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Snakemake">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-all-files-at-once" class="md-nav__link">
    <span class="md-ellipsis">
      Running all files at once
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-an-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Adding an environment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-automate-with-workflow-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Why Automate with Workflow Systems?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bonus-exercise" class="md-nav__link">
    <span class="md-ellipsis">
      Bonus exercise
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="workflows-automation-and-repeatability">Workflows, Automation, and Repeatability</h1>
<p>For everything we have done so far, we have copied and pasted a lot of commands
to accomplish what we want. This works! But can also be time consuming, and is
more prone to error. We will show you next how to put all of these commands into
a shell script.</p>
<p>A <strong>shell script</strong> is a text file full of shell commands, that run just as if you're
running them interactively at the command line.</p>
<h2 id="writing-a-shell-script">Writing a shell script</h2>
<p>Let's put some of our commands from the quality trimming module into one script.</p>
<p>We'll call it <code>run_qc.sh</code>. The <code>sh</code> at the end of the tells you that this is a bash script.</p>
<p>-First, cd into the <code>2020_rotation_project</code> directory</p>
<pre><code>cd ~/2020_rotation_project
</code></pre>
<p>Now, use <code>nano</code> to create and edit a file called <code>run-qc.sh</code> </p>
<p><code>nano run-qc.sh</code> will open the file. Now add the following text:</p>
<pre><code>cd ~/2020_rotation_project
mkdir -p quality
cd quality

ln -s ~/2020_rotation_project/raw_data/*.fastq.gz ./

printf &quot;I see $(ls -1 *.fastq.gz | wc -l) files here.\n&quot;

for infile in *_1.fastq.gz
  do
    name=$(basename ${infile} _1.fastq.gz)
    fastp --in1 ${name}_1.fastq.gz  --in2 ${name}_2.fastq.gz   --out1 ${name}_1.trim.fastq.gz --out2 ${name}_2.trim.fastq.gz  --detect_adapter_for_pe \
      --qualified_quality_phred 4  --length_required 31 --correction --json ${name}.trim.json --html ${name}.trim.html
  done

</code></pre>
<p>This is now a shell script that you can use to execute all of those commands in <em>one</em> go, including running <code>fastp</code> on all six samples!
Exit <code>nano</code> and try it out! </p>
<p>Run:</p>
<pre><code>cd ~/2020_rotation_project
bash run-qc.sh
</code></pre>
<h3 id="re-running-the-shell-script">Re-running the shell script</h3>
<p>Suppose you wanted to re-run the script. How would you do that?</p>
<p>Well, note that the <code>quality</code> directory is created at the top of the script, and everything is executed in that directory. So if you remove the quality directory like so,</p>
<pre><code>rm -rf quality
</code></pre>
<blockquote>
<p>The <code>-rf</code> here means that you'd like to remove the whole directory "recursively" (<code>r</code>) and that you'd like file deltion to happen <em>without</em> asking for permission for each file (<code>f</code>)</p>
</blockquote>
<p>You can then do:</p>
<pre><code>bash run-qc.sh
</code></pre>
<h3 id="some-tricks-for-writing-shell-scripts">Some tricks for writing shell scripts</h3>
<h4 id="make-it-executable">Make it executable</h4>
<p>You can get rid of the <code>bash</code> part of the command above with
some magic:</p>
<p>Put</p>
<pre><code>#! /bin/bash
</code></pre>
<p>at the top of the file, and then run</p>
<pre><code>chmod +x ~/2020_rotation_project/run-qc.sh
</code></pre>
<p>at the command line.</p>
<p>You can now run</p>
<pre><code>./run-qc.sh
</code></pre>
<p>instead of <code>bash run-qc.sh</code>.</p>
<p>You might be thinking, ok, why is this important? Well, you can do the same with R scripts and Python scripts (but put <code>/usr/bin/env Rscript</code> or <code>/usr/bin/env python</code> at the top, instead of <code>/bin/bash</code>). This basically annotates the script with the language it's written in, so you don't have to know or remember yourself.</p>
<p>So: it's not necessary but it's a nice trick.</p>
<p>You can also always <em>force</em> a script to be run in a particular language by specifying <code>bash &lt;scriptname&gt;</code> or <code>Rscript &lt;Scriptname&gt;</code>, too.</p>
<h2 id="automation-with-workflow-systems">Automation with Workflow Systems!</h2>
<p>Automation via shell script is wonderful, but there are a few problems here.</p>
<p>First, you have to run the entire workflow each time and it recomputes everything every time.
If you're running a workflow that takes 4 days, and you change a command at the end, you'll have to manually go in and just run the stuff that depends on the changed command.</p>
<p>Second, it's very <em>explicit</em> and not very <em>generalizable</em>. 
If you want to run it on a different dataset, you're going to have to change a lot of commands.</p>
<p>You can read more about using workflow systems to streamline data-intensive biology in our preprint <a href="https://www.biorxiv.org/content/10.1101/2020.06.30.178673v1">here</a>.</p>
<h2 id="snakemake">Snakemake</h2>
<p>Snakemake is one of several workflow systems that help solve these problems. </p>
<p>If you want to learn snakemake, we recommend working through a tutorial, such as the one <a href="https://hackmd.io/7k6JKE07Q4aCgyNmKQJ8Iw?view">here</a>. It's also worth checking out the snakemake documentation <a href="https://snakemake.readthedocs.io/en/stable/">here</a>.</p>
<p>Here, we'll demo how to run the same steps above, but in Snakemake.</p>
<p>First, let's install snakemake in our conda environment:</p>
<pre><code>mamba install -y snakemake-minimal
</code></pre>
<p>We're going to automate the same set of commands for trimming, but in snakemake.</p>
<p>Open a file called <code>Snakefile</code> using <code>nano</code>:</p>
<pre><code>nano Snakefile
</code></pre>
<p>Here is the command we would need for a single sample, <code>SRR1976948</code></p>
<pre><code>rule all:
    input:
        &quot;quality/SRR1976948_1.trim.fastq.gz&quot;,
        &quot;quality/SRR1976948_2.trim.fastq.gz&quot;

rule trim_reads:
    input:
        in1=&quot;raw_data/SRR1976948_1.fastq.gz&quot;,
        in2=&quot;raw_data/SRR1976948_2.fastq.gz&quot;,
    output:
        out1=&quot;quality/SRR1976948_1.trim.fastq.gz&quot;,
        out2=&quot;quality/SRR1976948_2.trim.fastq.gz&quot;,
        json=&quot;quality/SRR1976948.fastp.json&quot;,
        html=&quot;quality/SRR1976948.fastp.html&quot;
    shell:
        &quot;&quot;&quot;
        fastp --in1 {input.in1}  --in2 {input.in2}  \
        --out1 {output.out1} --out2 {output.out2}  \
        --detect_adapter_for_pe  --qualified_quality_phred 4 \
        --length_required 31 --correction \
        --json {output.json} --html {output.html}
        &quot;&quot;&quot;
</code></pre>
<p>We can run it like this:</p>
<pre><code>
snakemake -n
</code></pre>
<blockquote>
<p>the <code>-n</code> tells snakemake to run a "dry run" - that is, just check that the input files exist and all files specified in rule <code>all</code> can be created from the rules provided within the Snakefile).</p>
</blockquote>
<p>you should see "Nothing to be done."</p>
<p>That's because the trimmed files already exist!</p>
<p>Let's fix that:</p>
<pre><code>rm quality/SRR1976948*.trim.fastq.gz
</code></pre>
<p>and now, when you run <code>snakemake</code>, you should see the fastp being run. Yay w00t! Then if you run <code>snakemake</code> again, you will see that it doesn't need to do anything - all the files are "up to date".</p>
<h3 id="running-all-files-at-once">Running all files at once</h3>
<p>Snakemake wouldn't be very useful if it could only trim one file at a time, so let's modify the Snakefile so it <em>could</em> run more files at once:</p>
<pre><code>SAMPLES = [&quot;SRR1976948&quot;]
rule all:
    input:
        expand(&quot;quality/{sample}_1.trim.fastq.gz&quot;, sample=SAMPLES)
        expand(&quot;quality/{sample}_2.trim.fastq.gz&quot;, sample=SAMPLES)

rule trim_reads:
    input:
        in1=&quot;raw_data/{sample}_R1.fastq.gz&quot;,
        in2=&quot;raw_data/{sample}_R2.fastq.gz&quot;,
    output:
        out1=&quot;quality/{sample}_1.trim.fastq.gz&quot;,
        out2=&quot;quality/{sample}_2.trim.fastq.gz&quot;,
        json=&quot;quality/{sample}.fastp.json&quot;,
        html=&quot;quality/{sample}.fastp.html&quot;
    shell:
        &quot;&quot;&quot;
        fastp --in1 {input.in1}  --in2 {input.in2}  \
        --out1 {output.out1} --out2 {output.out2}  \
        --detect_adapter_for_pe  --qualified_quality_phred 4 \
        --length_required 31 --correction \
        --json {output.json} --html {output.html}
        &quot;&quot;&quot;
</code></pre>
<p>Try another dryrun:</p>
<pre><code>snakemake -n
</code></pre>
<p>Now actually run the workflow:</p>
<pre><code>snakemake -j 1
</code></pre>
<blockquote>
<p>the <code>-j 1</code> tells snakemake to run a single job at a time. You can increase this number if you have access to more cpu (e.g. you're in an <code>srun</code> session where you asked for more cpu with the <code>-n</code> parameter).</p>
</blockquote>
<p>Again, we see there's nothing to be done - the files exist! 
Try removing the quality trimmed files and running again.</p>
<pre><code>rm quality/*.trim.fastq.gz
</code></pre>
<h3 id="adding-an-environment">Adding an environment</h3>
<p>We've been using a conda environment throughout our modules. 
We can export the installed package names to a file that we can use to re-install all packages in a single step (like on a different computer). </p>
<pre><code>conda env export -n dib_rotation -f ~/2020_rotation_project/dib_rotation_environment.yaml
</code></pre>
<p>We can use this environment in our snakemake rule as well!</p>
<pre><code>SAMPLES = [&quot;SRR1976948&quot;]

rule all:
    input:
        expand(&quot;quality/{sample}_1.trim.fastq.gz&quot;, sample=SAMPLES)
        expand(&quot;quality/{sample}_2.trim.fastq.gz&quot;, sample=SAMPLES)

rule trim_reads:
    input:
        in1=&quot;raw_data/{sample}_1.fastq.gz&quot;,
        in2=&quot;raw_data/{sample}_2.fastq.gz&quot;,
    output:
        out1=&quot;quality/{sample}_1.trim.fastq.gz&quot;,
        out2=&quot;quality/{sample}_2.trim.fastq.gz&quot;,
        json=&quot;quality/{sample}.fastp.json&quot;,
        html=&quot;quality/{sample}.fastp.html&quot;
    conda: &quot;dib_rotation_environment.yaml&quot;
    shell:
        &quot;&quot;&quot;
        fastp --in1 {input.in1}  --in2 {input.in2}  \
        --out1 {output.out1} --out2 {output.out2}  \
        --detect_adapter_for_pe  --qualified_quality_phred 4 \
        --length_required 31 --correction \
        --json {output.json} --html {output.html}
        &quot;&quot;&quot;
</code></pre>
<p>Here, we just have a single environment, so it was pretty easy to just run the Snakefile while within our <code>dib_rotation</code> environment.
Using conda environment with snakemake becomes more useful as you use more tools, because it helps to keep different tools (which likely have different software dependencies) in separate conda environments.</p>
<p>Run snakemake with <code>--use-conda</code> to have snakemake use the conda environment for this step.</p>
<pre><code>snakemake -j 1 --use-conda
</code></pre>
<h2 id="why-automate-with-workflow-systems">Why Automate with Workflow Systems?</h2>
<p>Workflow systems contain powerful infrastructure for workflow management that can coordinate runtime behavior, self-monitor progress and resource usage, and compile reports documenting the results of a workow.
These features ensure that the steps for data analysis are minimally documented and repeatable from start to finish. 
When paired with proper software management, fully-contained workows are scalable, robust to software updates, and executable across platforms, meaning they will likely still execute the same set of commands with little investment by the user after weeks, months, or years.</p>
<p>Check out our <a href="https://www.biorxiv.org/content/10.1101/2020.06.30.178673v1">workflows preprint</a> for a guide.</p>
<h2 id="bonus-exercise">Bonus exercise</h2>
<p>The above exercise walks you through how to write and run a snakefile for quality trimming. 
For additional practice using snakemake, snakemake the entire rotation project (e.g., running sourmash and spacegraphcats). 
As a super extra bonus, you can even snakemake the data download step. 
Note you will need two conda environment yaml file, one for the spacegraphcats rule and one for the rest of the rules. </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020 <a href="http://ivory.idyll.org/lab/">Lab for Data Intensive Biology</a> at UC Davis
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>